###Stabilized_StandingBack:
###  base: UpSlope::Stabilizer::GoCenter
###
###Stabilized_GoRightBack:
###  base: WipingController::Stabilizer::RightFootFlatSupport
###  completion:
###    dcmEval: [0.01, 0.01, 0.1]

DownSlope::LeftFootTrajectory:
  base: MetaTasks
  tasks:
    LiftFootTask:
      type: bspline_trajectory
      stiffness: 50.0
      weight: 500.0
      duration: 3.0
      surface: LeftFootCenter
      # XXX should handle early impact/late impact
      completion:
        timeElapsed: true
      target:
        translation: [0.017046, 0.12, 0.025]
        rotation: [0.0, 0.0, 0.0]
      controlPoints:
        - [0.017046, 0.3, 0.25]
        - [0.017046, 0.15, 0.15]
        - [0.017046, 0.12, 0.1]

DownSlope::Stabilized::LeftFootTrajectory:
  base: Parallel
  states: [WipingController::Stabilizer::RightFootFlatSupport, DownSlope::LeftFootTrajectory]
  RemoveContacts:
    - r1: hrp4
      r2: ground
      r1Surface: LeftFootCenter
      r2Surface: AllGround

###Stabilized_LiftLeftFoot_Back:
###  base: Parallel
###  states: [Stabilized_GoRightBack, LiftLeftFoot_Back]
###  addContacts:
###    - r1: hrp4
###      r2: ground
###      r1Surface: RightFoot
###      r2Surface: AllGround
###  RemoveContacts:
###    - r1: hrp4
###      r2: ground
###      r1Surface: LeftFoot
###      r2Surface: AllGround
###      dof: [0.0, 0.0, 1.0, 1.0, 1.0, 0.0]
###  AddContactsAfter:
###    - r1: hrp4
###      r2: ground
###      r1Surface: LeftFoot
###      r2Surface: AllGround
###      dof: [0.0, 0.0, 1.0, 1.0, 1.0, 0.0]

WipingController_HalfSitting:
  base: HalfSitting
  stiffness: 5.0
  eval: 1.0
  AddCollisions:
    - r1: hrp4
      r2: tilted_board
      collisions:
        - body1: r_wrist
          body2: ground
          iDist: 0.1
          sDist: 0.02
          damping: 0.0
    - r1: hrp4
      r2: wall
      collisions:
        - body1: l_wrist
          body2: ground
          iDist: 0.05
          sDist: 0.02
          damping: 0.0

WipingController_StabilizedHalfSitting:
  base: Parallel
  states: [Stabilized_StandingBack, WipingController_HalfSitting]

DownSlope::Stabilizer::GoCenter:
  base: WipingController::Stabilizer::Go
  stiffness: 3
  above: CenterAnkles
  completion:
    dcmEval: [0.02, 0.05, 0.2]
  StabilizerConfig:
    contacts: [Left, Right]
    # Target flat floor with right foot, and current orientation of the left (slope)
    Right:
      overwriteRPY:
        roll: 0
        pitch: 0
      height: 0

DownSlope::Stabilizer::GoRight:
  base: DownSlope::Stabilizer::GoCenter
  above: RightAnkle
  StabilizerConfig:
    contacts: [Left, Right]

DownSlope::PutLeftFoot:
  base: UpSlope::PutLeftFoot

DownSlope::Stabilized::PutLeftFoot:
  base: Parallel
  states: [WipingController::Stabilizer::RightFootFlatSupport, DownSlope::PutLeftFoot]


DownSlope::FSM::StepDownSlope:
  base: Meta
  transitions:
    - [DownSlope::Stabilizer::GoCenter, OK, DownSlope::Stabilizer::GoRight]
    - [DownSlope::Stabilizer::GoRight, OK, DownSlope::Stabilized::LeftFootTrajectory]
      #- [DownSlope::Stabilized::LeftFootTrajectory, OK, DownSlope::Stabilized::PutLeftFoot]
    # - [Stabilized_StandingBack, OK, WipingController_StabilizedHalfSitting, Auto]
    # - [WipingController_StabilizedHalfSitting, OK, Stabilized_GoRightBack, Auto]
    #   #- [Stabilized_GoRightBack, OK, Stabilized_LiftLeftFoot_Back, Auto]
    #   #- [Stabilized_LiftLeftFoot_Back, OK, WipingController::Stabilizer::GoCenterFlat, Auto]
    #   
#["Stabilized_StandingBack", "OK", "Stabilized_GoRightBack"],
#["Stabilized_GoRightBack", "OK", "Stabilized_LiftLeftFoot_Back"],
#["Stabilized_LiftLeftFoot_Back", "OK", "Stabilized_PutLeftFoot_Back"],
#["Stabilized_PutLeftFoot_Back", "OK", "Stabilizer::GoCenter"],
#
#    - [WipingController::Stabilizer::GoCenterFlat, OK, WipingController::Stabilizer::GoRightFlat]
#    - [WipingController::Stabilizer::GoRightFlat, OK, UpSlope::Stabilized::LeftFootTrajectory]
#    - [UpSlope::Stabilized::LeftFootTrajectory, OK, UpSlope::Stabilized::PutLeftFoot]
#    - [UpSlope::Stabilized::PutLeftFoot, OK, UpSlope::Stabilizer::GoCenter]
