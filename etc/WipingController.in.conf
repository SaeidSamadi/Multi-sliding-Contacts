{
  // If true, the FSM transitions are managed by an external tool
  "Managed": false,
  // If true and the FSM is self-managed, transitions should be triggered
  "StepByStep": false,
  // Change idle behaviour, if true the state is kept until transition,
  // otherwise the FSM holds the last state until transition
  "IdleKeepState": true,
  // Where to look for state libraries
  "StatesLibraries": ["@MC_STATES_DEFAULT_INSTALL_PREFIX@","@MC_STATES_INSTALL_PREFIX@"],
  // Where to look for state files
  "StatesFiles": ["@MC_STATES_DEFAULT_INSTALL_PREFIX@/data","@MC_STATES_INSTALL_PREFIX@/data"],
  // If true, state factory will be more verbose
  "VerboseStateFactory": false,


  "UseFeetForceControl": true,

  "CoMQPConfig":
  {
    "debug": false,
    "com": {
      "pos": [0.0, 0.0, 0.8]
    },
    "left_foot": {
      "shape": [0.12, 0.065],
      "friction": 0.5
    },
    "right_foot": {
      "shape": [0.12, 0.065],
      "friction": 0.5
    },
    "right_hand":{
      "shape": [0.1, 0.05],
      "friction": 0.1
    },
    "left_hand":{
      "shape": [0.1, 0.05],
      "friction": 0.1
    }
  },

  "HandForceFilter":
  {
    "m": 5,
    "n": 2,
    "t": 5,
    "s": 0
  },

  // Additional robots to load
  "robots":
  {
    "ground":
    {
      "module": "env",
      "params": ["@AROBASE@MC_ENV_DESCRIPTION@AROBASE@", "ground"]
    },
    "wall":
    {
      "module": "object",
      "params": ["@AROBASE@MC_ENV_DESCRIPTION@AROBASE@", "ground"],
      "init_pos": {
        "translation": [0.45, 0.0, 0.0], // P = 0.45
        "rotation": [0.0, -1.57, 0.0]
      }
    },
    "tilted_board":
    {
      "module": "object",
      "params": ["@AROBASE@MC_ENV_DESCRIPTION@AROBASE@", "ground"],
      "init_pos": {
        "translation": [7.3, 0.0, 7.7], // Theta T; [10Cos|T|+P, 0.0, 10Sin|T|+h]; h:height of tiltedSurface from ground
        "rotation": [0.0, -0.785, 0.0] //T = -45deg
      }
    }
  },
  // General constraints, always on
  "constraints":
  [
    {
      "type": "contact"
    },
    {
      "type": "dynamics",
      "robotIndex": 0,
      "damper": [0.1, 0.01, 0.5]
    }
  ],
  // Collision constraint
  "collisions":
  [
    {
      "type": "collision",
      "r1Index": 0,
      "r2Index": 0,
      "useMinimal": true
    },
    {
       "type": "collision",
       "r1Index": 0,
       "r2Index": 2,
       "collisions": [
           {
               "body1": "NECK_P_LINK",
               "body2": "ground",
               "iDist": 0.5,
               "sDist": 0.02,
               "damping": 0.0
           },
          // {
          //     "body1": "l_wrist",
          //     "body2": "ground",
          //     "iDist": 0.5,
          //     "sDist": 0.02,
          //     "damping": 0.0
          // },
           {
               "body1": "torso",
               "body2": "ground",
               "iDist": 0.5,
               "sDist": 0.02,
               "damping": 0.0
           },
          // {
          //     "body1": "body",
          //     "body2": "ground",
          //     "iDist": 0.5,
          //     "sDist": 0.02,
          //     "damping": 0.0
          // }
      ]
    }
  ],
  // Initial set of contacts
  "contacts":
  [
    {
      "r1": "hrp4",
      "r2": "ground",
      "r1Surface": "LeftFoot",
      "r2Surface": "AllGround",
      //"dof": [0,0,0,0,0,0]
      "dof": [1,1,1,1,1,1]
    },
    {
      "r1": "hrp4",
      "r2": "ground",
      "r1Surface": "RightFoot",
      "r2Surface": "AllGround",
      //"dof": [0,0,0,0,0,0]
      "dof": [1,1,1,1,1,1]
    },
    {
      "r1": "ground",
      "r2": "wall",
      "r1Surface": "AllGround",
      "r2Surface": "AllGround"
    }
  ],
  // // Configuring the observer pipeline
  "RunObservers": ["Encoder", "BodySensor", "KinematicInertial"],
  "UpdateObservers": ["Encoder", "KinematicInertial"],
  "states":
  {
    "WipingController_RightHandToWhiteboard":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 100.0,
          "weight": 2000.0,
          "above": ["LeftFootCenter", "RightFootCenter"],
          "unactiveJoints":["L_SHOULDER_R", "L_SHOULDER_P", "L_SHOULDER_Y"],
        },
         "LookAtRightHand":
        {
          "type": "lookAtSurface",
          "robot": "hrp4",
          "robotIndex": 0,
          "body": "xtion_link",
          "bodyVector": [1.0, 0.0, 0.0],
          "surfaceRobotIndex": 0,
          "surface": "RightHandPad",
          "stiffness": 10.0,
          "weight": 10.0
        },
        "RightHandTrajectory":
        {
          "type": "bspline_trajectory",
          "setupMode": false,
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 50.0,
          "duration": 4.0,
          "dimWeight": [1.0, 1.0, 1.0, 1.0, 0.5, 0.5],
          "displaySamples": 100,
          "completion":
          {
            "AND":
            [
              {
                "OR":
                [
                  { "eval": 1e-4 },
                  {"AND":
                    [
                      { "timeout": 5.0 },
                      { "speed": 1e-3 }
                    ]
                  }
                ]
              },
              {
                "timeElapsed": true
              }
            ]
          },
          "target":
          {
            "translation": [0.35, -0.4, 1.0],
            "rotation": [-0.785,0.0,1.57]
          },
          // control points wrt to target frame
          "controlPoints":
          [
            [0.0, -0.5, 0.85]
          ],
          "oriWaypoints":
          [
            [3.5, [-0.785,0.0,1.57]]
          ],
        },
      },
      "AddCollisions": [
        {
           "r1": "hrp4",
           "r2": "tilted_board",
           "collisions": [
               {
                   "body1": "r_wrist",
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.03,
                   "damping": 0.0
               }
          ]
        }
      ]
    },
    "Stabilized_RightHandToWhiteboard":
    {
      "base": "Parallel",
      "states": ["Stabilizer::Standing", "WipingController_RightHandToWhiteboard"],
    },
    "WipingController_LeftHandToWhiteboard":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 100.0,
          "weight": 2000.0,
          "above": ["LeftFootCenter", "RightFootCenter"]
        },
         "LookAtLeftHand":
        {
          "type": "lookAtSurface",
          "robot": "hrp4",
          "robotIndex": 0,
          "body": "xtion_link",
          "bodyVector": [1.0, 0.0, 0.0],
          "surfaceRobotIndex": 0,
          "surface": "LeftHandPad",
          "stiffness": 10.0,
          "weight": 10.0
        },
        "KeepRightHand":
        {
          "type": "surfaceTransform",
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 10.0,
          "dimWeight": [1,1,1,1,1,1]
        },
        "LeftHandTrajectory":
        {
          "type": "bspline_trajectory",
          "setupMode": false,
          "surface": "LeftHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 50.0,
          "duration": 4.0,
          "dimWeight": [1.0, 1.0, 1.0, 1.0, 0.5, 0.5],
          "displaySamples": 100,
          "completion":
          {
            "AND":
            [
              {
                "OR":
                [
                  { "eval": 1e-4 },
                  {"AND":
                    [
                      { "timeout": 5.0 },
                      { "speed": 1e-3 }
                    ]
                  }
                ]
              },
              {
                "timeElapsed": true
              }
            ]
          },
          "target":
          {
            "translation": [0.45, 0.4, 1.1],
            "rotation": [1.57,0.0,-1.57]
          },
          // control points wrt to target frame
          "controlPoints":
          [
            [0.17, 0.5, 0.85]
          ],
          "oriWaypoints":
          [
            [3.5, [1.57,0.0,-1.57]]
          ]
        }
      }
    },
    "WipingController_RightHandTrajectory":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "RightHandTrajectory":
        {
          "type": "bspline_trajectory",
					"setupMode": false,
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 15.0,
          "duration": 10.0,
          "dimWeight": [1.0, 1.0, 1.0, 0.3, 1.0, 1.0],
          "displaySamples": 100,
          "completion": { "timeElapsed": true },
          "target":
          {
            "translation": [0.55, -0.2, 1.3],
            "rotation": [-1.57,0.0,1.57]
          },
          // control points wrt to target frame
          "controlPoints":
          [
            [0.55, -0.4, 1.5],
            [0.55, -0.25, 1.0],
            [0.55, -0.3, 1.1]
          ],
          "oriWaypoints":
          [ ]
        }
      }
    },
    "WipingController_RightHandConstantAcceleration":
    {
      "base": "WipingController_ConstantAcceleration",
      "refAccel":
      {
        "angular": [0.0,0.0,0.0],
        "linear": [0.005,0.0,0.0]
      },
      "initVel":
      {
        "angular": [0.0,0.0,0.0],
        "linear": [0.0,0.0,0.0]
      },
      "evalSpeed": 0.05
    },
    "WipingController_KeepRightHand":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "KeepRightHand":
        {
          "type": "surfaceTransform",
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 10.0,
          "dimWeight": [1,1,1,0,1,0]
        }
      }
    },
    "WipingController_ConstantAccelerationTrajectory":
    {
      "base": "Parallel",
      "states": ["WipingController_KeepRightHand", "WipingController_RightHandConstantAcceleration"]
    },
    "WipingController_PrepareWipingJSON_rh":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 100.0,
          "weight": 1000.0
        },
        "KeepRightHand":
        {
          "type": "surfaceTransform",
          "robotIndex": 0,
          "surface": "RightHandPad",
          "stiffness": 5.0,
          "dimWeight": [1.0,1.0,1.0,1.0,1.0,0.1]
        },
        "RightHandAdmittance":
        {
          "type": "admittance",
          "robotIndex": 0,
          "surface": "RightHandPad",
          "wrench":
          {
            "couple": [0.0, 0.0, 0.0],
            "force": [0.0, 0.0, 2.5]
          },
          "admittance":
          {
            "couple": [0.0, 0.0, 0.0],
            "force": [0.0, 0.0, 0.01]
          },
          "completion": {
            "wrench":
            {
              "couple": [0.0, 0.0, 0.0],
              "force": [0.0, 0.0, 0.5]
            }
          }
        }
      }
    },
    "WipingController_PrepareWipingJSON_lh":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 100.0,
          "weight": 1000.0
        },
        "KeepLeftHand":
        {
          "type": "surfaceTransform",
          "robotIndex": 0,
          "surface": "LeftHandPad",
          "stiffness": 5.0,
          "dimWeight": [1.0,1.0,1.0,1.0,1.0,0.1]
        },
        "KeepRightHand":
        {
          "type": "surfaceTransform",
          "robotIndex": 0,
          "surface": "RightHandPad",
          "stiffness": 5.0,
          "dimWeight": [1.0,1.0,1.0,1.0,1.0,1.0]
        },
        "LeftHandAdmittance":
        {
          "type": "admittance",
          "robotIndex": 0,
          "surface": "LeftHandPad",
          "wrench":
          {
            "couple": [0.0, 0.0, 0.0],
            "force": [0.0, 0.0, 2.5]
          },
          "admittance":
          {
            "couple": [0.0, 0.0, 0.0],
            "force": [0.0, 0.0, 0.005]
          },
          "completion": {
            "wrench":
            {
              "couple": [0.0, 0.0, 0.0],
              "force": [0.0, 0.0, 0.5]
            }
          }
        }
      }
    },
    "WipingController_PreparePushWallAuto_rh":
    {
      "base": "WipingController_PushWall_rh",
      "useCoMQP": true,
      "duration": 2.0,
      "maxDuration": 3.0,
      "maxForce": 10,
      "forceThreshold": 1,
      "admittance": [0.0,0.0,0.0,0.0,0.0,0.005],
			"initFromCoMQP": false,
      "comStiffness": 60
    },
    "WipingController_PreparePushWallAuto_lh":
    {
      "base": "WipingController_PushWall_lh",
      "useCoMQP": true,
      "duration": 2.0,
      "maxDuration": 3.0,
      "maxForce": 10,
      "forceThreshold": 1,
      "admittance": [0.0,0.0,0.0,0.0,0.0,0.005],
			"initFromCoMQP": false,
      "comStiffness": 60
    },
    "WipingController_RightHandConstantVelocity":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "RightHandTrajectoryConstantVelocity":
        {
          "type": "surfaceTransform",
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "damping": 20.0,
          "stiffness": 0.0,
          "dimWeight": [0,0,0,1,0,0],
          "refVel" : [0.0, 0.0, 0.0, 0.05, 0.0, 0.0],
          "completion" : { "timeout": 3.0 }
        },
        "KeepRightHand":
        {
          "type": "surfaceTransform",
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 10.0,
          "dimWeight": [1,1,1,0,1,0]
        }
      }
    },
    "WipingController_RightHandConstantVelocityVertical":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "RightHandTrajectoryConstantVelocity":
        {
          "type": "surfaceTransform",
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "damping": 20.0,
          "stiffness": 0.0,
          "dimWeight": [0,0,0,0,1,0],
          "refVel" : [0.0, 0.0, 0.0, 0.0, -0.05, 0.0],
          "completion" : { "timeout": 4.0 }
        },
        "KeepRightHand":
        {
          "type": "surfaceTransform",
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 10.0,
          "dimWeight": [1,1,1,1,0,0]
        }
      }
    },
    // #########################################################################	
    // Move the Left Foot Left Using Stabilizer
    // #########################################################################
    "LiftLeftFoot_UpSlope":
    {
    	"base": "MetaTasks",
    	"RemoveContacts":[
    		{
    			"r1": "hrp4",
        				"r2": "ground",	
        				"r1Surface": "LeftFoot",
        				"r2Surface": "AllGround",
    		},
    	],
    	"tasks":{
    		"LiftFootTask":
    		{
    			"type": "bspline_trajectory",
    			"robot": "hrp4",
    			"stiffness": 50.0,
    			"weight": 1000.0,
    			"duration": 4.0,
    			"surface": "LeftFootCenter",
    			"completion":
    			{
    				"AND":[
    					{"OR":[ {"eval":1e-4},
    						{"AND": [{"timeout":5.0},
    					 		 {"speed":1e-3}]}]},
    					{"timeElapsed":true}]
    			},
    			"target":
    			{
    				"translation":[0.017046, 0.25, 0.1],
    				"rotation":[0.523, 0.0, 0.0],
    			},
    			"controlPoints":[[0.017046, 0.08, 0.002],
    					 [0.017046, 0.10, 0.08],
    					 [0.017046, 0.12, 0.15]],
    		},
    	},
    },
    "LiftLeftFoot_UpStair":
    {
      "base": "LiftLeftFoot_UpSlope",
      "tasks":
      {
        "LiftFootTask":
        {
          "target":
          {
				  	"translation":[0.017046, 0.30, 0.275],
				  	"rotation":[0.0, 0.0, 0.0],
          },
			  	"controlPoints":[[0.017046, 0.08, 0.002],
			  			 [0.017046, 0.10, 0.15],
			  			 [0.017046, 0.12, 0.30]],
          },
      },
    },
    "PutLeftFootSlope":
    {
    	"base": "MetaTasks",
    	"tasks":{
    	  	"LeftFootAdmittance":
    			{
    			"type": "admittance",
    			"robot": "hrp4",
    			"surface":"LeftFootCenter",
    			"stiffness": [10, 10, 10, 10, 10, 1],
    			"damping": [6.3, 6.3, 6.3, 6.3, 6.3, 300],
    			"admittance": [0,0,0,0,0,0.001],
    			"maxVel":{
    				"linear": [0.2, 0.2, 0.5],
    				"angular": [0.2, 0.2, 0.2],
    			},
    			"wrench":
    			{
    				"couple":[0.0, 0.0, 0.0],
    				"force":[0.0, 0.0, 40.0],
    			},
    			"completion":
            {
    				"wrench":{
    					"force": [NaN, NaN, 40],
    					"couple": [NaN, NaN, NaN],
    				}
    			},
    		},
    	},
    },
    "PutLeftFootStair":
    {
      "base": "PutLeftFootSlope",
      "tasks":
      {
        "LeftFootAdmittance":
        {
          "wrench":
          {
            "force": [0.0, 0.0, 30.0],
          },
    			"completion":
          {
    		  	"wrench":{
    		  		"force": [NaN, NaN, 30.0],
    		  		"couple": [NaN, NaN, NaN],
    		  	}
          },
        },
      },
    },
    "PutLeftFoot_UpSlope":
    {
    	"base": "PutLeftFootSlope",
    	"AddContactsAfter":[
    		{
    			"r1": "hrp4",
        				"r2": "ground",
        				"r1Surface": "LeftFoot",
        				"r2Surface": "AllGround",
    			"dof":[1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
    		},
    		{
    			"r1": "hrp4",
        				"r2": "ground",
        				"r1Surface": "RightFoot",
        				"r2Surface": "AllGround",
    			"dof":[1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
    		},
    	],
    },
    "PutLeftFoot_UpStair":
    {
    	"base": "PutLeftFootStair",
    	"AddContactsAfter":[
    		{
    			"r1": "hrp4",
        				"r2": "ground",
        				"r1Surface": "LeftFoot",
        				"r2Surface": "AllGround",
    			"dof":[1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
    		},
    		{
    			"r1": "hrp4",
        				"r2": "ground",
        				"r1Surface": "RightFoot",
        				"r2Surface": "AllGround",
    			"dof":[1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
    		},
    	],
    },
  	"Stabilized_LiftLeftFoot_UpSlope":
  	{
  		"base": "Parallel",
  		"states": ["Stabilizer::RightSupport", "LiftLeftFoot_UpSlope"]
  	},
  	"Stabilized_LiftLeftFoot_UpStair":
  	{
  		"base": "Parallel",
  		"states": ["Stabilizer::RightSupport", "LiftLeftFoot_UpStair"]
  	},
  	"Stabilized_PutLeftFoot_UpSlope":
  	{
  		"base": "Parallel",
  		"states":["Stabilizer::RightSupport", "PutLeftFoot_UpSlope"]
  	},
  	"Stabilized_PutLeftFoot_UpStair":
  	{
  		"base": "Parallel",
  		"states":["Stabilizer::RightSupport", "PutLeftFoot_UpStair"]
  	},
    "Stabilized_StandingSlope":
    {
      "base": "Stabilizer::Standing",
      "AddContacts":
      [
          { 
            "r1": "hrp4",
            "r2": "ground",
            "r1Surface": "LeftFoot",
            "r2Surface": "AllGround",
            "dof": [0, 0, 1, 1, 1, 0],
          },
          { 
            "r1": "hrp4",
            "r2": "ground",
            "r1Surface": "RightFoot",
            "r2Surface": "AllGround",
            "dof": [0, 0, 1, 1, 1, 0],
          },
      ],
    },
  	"Stabilized_StandingStair":
    {
      "base": "Stabilized_StandingSlope",
    },
  	"Stabilized_GoRightSlope":
  	{
  		"base": "Stabilizer::GoRight",
  		"AddContacts":
  		[
  			{
  				"r1": "hrp4",
        	"r2": "ground",
        	"r1Surface": "LeftFoot",
        	"r2Surface": "AllGround",
        	"dof":[0.0, 0.0, 1.0, 1.0, 1.0, 0.0]
  			},
  			{
  				"r1": "hrp4",
        	"r2": "ground",
        	"r1Surface": "RightFoot",
        	"r2Surface": "AllGround",
        	"dof":[0.0, 0.0, 1.0, 1.0, 1.0, 0.0]
  			},
  		],
  	},
  	"Stabilized_GoRightStair":
    {
      "base": "Stabilized_GoRightSlope",
    },
    "WipingController_MoveRightHandDown":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 50.0,
          "weight": 2000.0,
          "above": ["LeftFootCenter", "RightFootCenter"],
          "completion": { "OR": [ { "eval": 1e-2 },
            {"AND": [ { "timeout": 3.0 }, { "speed": 1e-2 } ] } ] }
        },
        "LookAtWall":
        {
          "type": "lookAt",
          "robot": "hrp4",
          "robotIndex": 0,
          "body": "xtion_link",
          "targetVector": [1.0, 0.0, 1.0],
          "bodyVector": [1.0, 0.0, 0.0],
          "targetVector": [2.0, 0.0, 0.0],
          "stiffness": 1.0,
          "weight": 10.0,
          "completion": { "OR": [ { "eval": 1e-2 },
             { "timeout": 3.0 } ] }
        },
        "RightHandTrajectory":
        {
          "type": "bspline_trajectory",
          "setupMode": false,
          "surface": "RightHandPad",
          "robotIndex": 0,
          "weight" :  1000.0,
          "stiffness": 50.0,
          "duration": 5.0,
          //"dimWeight": [1.0, 1.0, 1.0, 1.0, 0.5, 0.5],
          "displaySamples": 100,
          "completion":
          {
            "AND":
            [
              {
                "OR":
                [
                  { "eval": 1e-4 },
                  {"AND":
                    [
                      { "timeout": 5.0 },
                      { "speed": 1e-3 }
                    ]
                  }
                ]
              },
              {
                "timeElapsed": true
              }
            ]
          },
          "target":
          {
            "translation": [0.125, -0.3, 0.75],
            //"rotation": [-1.57,0.0,1.57]
					  "rotation":[1.5708, -0.75, 0.0],
          },
          // control points wrt to target frame
          "controlPoints":
          [
            [0.5, -0.4, 0.9],
            [0.1, -0.5, 0.9]
          ],
          "oriWaypoints":
          [
            [3.0, [1.5708, -1.5708, 0.0]]
          ]
        },
      },
     // "AddCollisions": [
     //   {
     //      "r1": "hrp4",
     //      "r2": "wall",
     //      "collisions": [
     //          {
     //              "body1": "r_wrist",
     //              "body2": "ground",
     //              "iDist": 0.5,
     //              "sDist": 0.02,
     //              "damping": 0.0
     //          }
     //     ]
     //   }
     // ]
    },
  	"Stabilized_GoCenterSlope":
  	{
  		"base": "Stabilizer::GoCenter",
  		"StabilizerConfig":
  		{
  			"tasks":
  			{
  				"com":
  				{
  					"stiffness": [10.0, 10.0, 10.0],
  				},
  			},
  			"Left":
  			{
  				//"height": 0.20,
          "rotation": [0.523, 0.0, 0.0],
  			},
  		},
    },
  	"Stabilized_GoCenterStair":
  	{
  		"base": "Stabilizer::GoCenter",
  		"StabilizerConfig":
  		{
  			"tasks":
  			{
  				"com":
  				{
  					"stiffness": [5.0, 5.0, 5.0],
  				},
  			},
  			"Left":
  			{
  				"height": 0.20,
  			},
  		},
  	},
  	"Stabilized_StepUpSlope":
  	{
  		"base": "Meta",
  		"transitions":
      [
  			["Stabilized_StandingSlope", "OK", "Stabilized_GoRightSlope"],
  			["Stabilized_GoRightSlope", "OK", "Stabilized_LiftLeftFoot_UpSlope"],
  			["Stabilized_LiftLeftFoot_UpSlope", "OK", "Stabilized_PutLeftFoot_UpSlope"],
  			["Stabilized_PutLeftFoot_UpSlope", "OK", "Stabilized_GoCenterSlope"],
  		],
      "AddCollisions": [
        {
           "r1": "hrp4",
           "r2": "tilted_board",
           "collisions": [
               {
                   "body1": "r_wrist",
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.02,
                   "damping": 0.0
               }
          ]
        }
      ]
  	},
  	"Stabilized_StepUpStair":
  	{
  		"base": "Meta",
  		"transitions":
      [
  			["Stabilized_StandingStair", "OK", "Stabilized_GoRightStair"],
  			["Stabilized_GoRightStair", "OK", "Stabilized_LiftLeftFoot_UpStair"],
  			["Stabilized_LiftLeftFoot_UpStair", "OK", "Stabilized_PutLeftFoot_UpStair"],
  			["Stabilized_PutLeftFoot_UpStair", "OK", "Stabilized_GoCenterStair"],
  		],
  	},
		"WipingController_WipeItBabyState":
		{
			"base": "WipingController_WipeItBaby_rh",
			"admittance": [0.0,0.0,0.0,0.0,0.0,0.003],
      "feetForceControl": true
		},
    "WipingController_WipeItStateTrajectory":
    {
      "base": "Parallel",
      "states": ["WipingController_WipeItBabyState", "WipingController_RightHandTrajectory"]
    },
    "WipingController_WipeItStateConstantVelocity":
    {
      "base": "Parallel",
      "states": ["WipingController_WipeItBabyState", "WipingController_RightHandConstantVelocity"]
    },
    "WipingController_WipeItStateConstantVelocityVertical":
    {
      "base": "Parallel",
      "states": ["WipingController_WipeItBabyState", "WipingController_RightHandConstantVelocityVertical"]
    },
    "WipingController_WipeItStateConstantAcceleration":
    {
      "base": "Parallel",
      "states": ["WipingController_WipeItBabyState", "WipingController_ConstantAccelerationTrajectory"]
    },
    "WipingController_PrepareMoveHandBack":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 50.0,
          "weight": 2000.0,
          "above": ["LeftFootCenter", "RightFootCenter"],
          "completion": { "OR": [ { "eval": 1e-2 },
            {"AND": [ { "timeout": 3.0 }, { "speed": 1e-2 } ] } ] }
        },
        "MoveRightHand":
        {
          "type": "surfaceTransform",
          "robotIndex": 0,
          "surface": "RightHandPad",
          "stiffness": 5.0,
          "weight" : 500,
          "moveWorld":
          {
            "translation": [-0.2, -0.15, 0.0]
          },
          "completion": { "OR": [ { "eval": 1e-2 },
            {"AND": [ { "timeout": 3.0 }, { "speed": 1e-2 } ] } ] }
        }
      }
    },
    "WipingController_PrepareMoveHandBackManual":
    {
			"base": "WipingController_PrepareMoveHandBack"
		},
    "WipingController_CoM":
    {
      "base": "MetaTasks",
      "tasks":
      {
        "CoM":
        {
          "type": "com",
          "robotIndex": 0,
          "stiffness": 50.0,
          "weight": 5000.0,
          "above": ["LeftFootCenter", "RightFootCenter"],
          "completion": { "OR": [ { "eval": 1e-3 },
            {"AND": [ { "timeout": 10.0 }, { "speed": 1e-3 } ] } ] }
        }
      }
    },
    "WipingController_HalfSitting":
    {
      "base": "HalfSitting",
      "stiffness": 10.0,
      "AddCollisions": [
        {
           "r1": "hrp4",
           "r2": "wall",
           "collisions": [
               {
                   "body1": "r_wrist",
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.02,
                   "damping": 0.0
               }
          ]
        }
      ]
    },
    "WipingController_HalfSittingWithCoM":
    {
      "base": "Parallel",
      "states": ["WipingController_HalfSitting", "WipingController_CoM"]
    },
    "WipingController_PushWallCoMQP":
    {
      "base": "WipingController_PushWall_rh",
      "useCoMQP": true,
      "duration": 3.0,
      "maxDuration": 4.0,
      "maxForce": 60,
      "forceThreshold": 5,
      "admittance": [0.0,0.0,0.0,0.0,0.0,0.003],
			"initFromCoMQP": true,
			"comStiffness": 60
    },
    "WipingController_ReleasePushWallCoMQP":
    {
      "base": "WipingController_PushWallCoMQP",
      "useCoMQP": true,
      "maxForce": 1,
      "forceThreshold": 5,
      "admittance": [0.0,0.0,0.0,0.0,0.0,0.005],
      "stiffness": [200,200,200,200,200,1],
      "damping": [28,28,28,28,28,300]
    },
    "WipingController_PushWallNoCoMQP":
    {
      "base": "WipingController_PushWallCoMQP",
      "useCoMQP": false,
			"initFromCoMQP": false, 
			"maxForce": 60,
      "maxDuration": 4.0
    },
		"WipingController_PrepareWipingState_rh":
		{
			"base": "WipingController_PreparePushWallAuto_rh",
      "maxForce": 10,
      "admittance": [0.0,0.0,0.0,0.0,0.0,0.002],
			"comStiffness": 60
		},
		"WipingController_PrepareWipingState_lh":
		{
			"base": "WipingController_PreparePushWallAuto_lh",
      "maxForce": 15,
      "admittance": [0.0,0.0,0.0,0.0,0.0,0.002],
			"comStiffness": 30
		},
    "WipingController_PrepareWipingState":
    {
      "base": "Parallel",
      "states": ["WipingController_PrepareWipingState_rh", "WipingController_PrepareWipingState_lh"],
      //"states": ["WipingController_PrepareWipingState_rh", "WipingController_KeepRightHand", "WipingController_KeepLeftHand", "WipingController_PrepareWipingState_lh"]
      "AddCollisions": [
        {
           "r1": "hrp4",
           "r2": "tilted_board",
           "collisions": [
               {
                   "body1": "torso",
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.02,
                   "damping": 0.0
               }
          ]
        },
        {
           "r1": "hrp4",
           "r2": "wall",
           "collisions": [
               {
                   "body1": "torso",
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.02,
                   "damping": 0.0
               }
          ]
        },
        {
           "r1": "hrp4",
           "r2": "tilted_board",
           "collisions": [
               {
                   "body1": "NECK_P_LINK",
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.02,
                   "damping": 0.0
               }
          ]
        },
        {
           "r1": "hrp4",
           "r2": "wall",
           "collisions": [
               {
                   "body1": "NECK_P_LINK", 
                   "body2": "ground",
                   "iDist": 0.5,
                   "sDist": 0.02,
                   "damping": 0.0
               }
          ]
        }
      ]
    },
    "Stabilized_StandingBack":
      {
        "base": "Stabilizer::Standing",
        "AddContacts":
        [
            { 
              "r1": "hrp4",
              "r2": "ground",
              "r1Surface": "LeftFoot",
              "r2Surface": "AllGround",
              "dof": [0, 0, 1, 1, 1, 0],
            },
            { 
              "r1": "hrp4",
              "r2": "ground",
              "r1Surface": "RightFoot",
              "r2Surface": "AllGround",
              "dof": [0, 0, 1, 1, 1, 0],
            },
        ],
        "StabilizerConfig":
        {
          "tasks":
            {
              "com":
                {
                  "stiffness": [100.0, 100.0, 10.0],
                },
              "Left":
              {
                "height": 0.2,
              }
            },
        },
      },
  	"Stabilized_GoRightBack":
  	{
  		"base": "Stabilizer::GoRight",
  		"StabilizerConfig":
  		{
  			"tasks":
  			{
  				"com":
  				{
  					"stiffness": [100.0, 100.0, 10.0],
  					"height": 0.78,
  				},
  			},
  			"dcm_tracking":
  			{
  				"gains":
  				{
  					"prop": 3.0,
  					"integral": 4.0,
  					"deriv": 0.0,
  				},
  			},
  			"Left":
  			{
  				"height": 0.20,
  			},
  		},
  		"completion":
  		{
  			"dcmEval": [0.015, 0.015, 0.1],
  		},
  		
  	},
  	"LiftLeftFoot_Back":
  	{
  		"base": "LiftLeftFoot_UpSlope",
  		"RemoveContacts":[
  			{
  				"r1": "hrp4",
        				"r2": "step",	
        				"r1Surface": "LeftFoot",
        				"r2Surface": "TableTop",
  			},
  		],
  		"tasks":{
  			"LiftFootTask":
  			{
  				"target":
  				{
  					"translation": [0.017046, 0.12, 0.025],
  					"rotation": [0.0, 0.0, 0.0],
  				},
  				"controlPoints":[[0.017046, 0.3, 0.25],
  						 [0.017046, 0.15, 0.3],
  						 [0.017046, 0.12, 0.10]],
  			},
  		},
  	},
  	"Stabilized_LiftLeftFoot_Up":
  	{
  		"base": "Parallel",
  		"states": ["Stabilizer::RightSupport", "LiftLeftFoot_Up"]
  	},
  	"Stabilized_LiftLeftFoot_Back":
  	{
  		"base": "Parallel",
  		"states": ["Stabilizer::RightSupport", "LiftLeftFoot_Back"],
        "AddCollisions": [
          {
             "r1": "hrp4",
             "r2": "wall",
             "collisions": [
                 {
                     "body1": "r_wrist",
                     "body2": "ground",
                     "iDist": 0.5,
                     "sDist": 0.02,
                     "damping": 0.0
                 }
            ]
          }
        ]
  	},
  	"PutLeftFoot_Back":
  	{
  		"base": "PutLeftFootSlope",
  		"AddContactsAfter":[
  			{
  				"r1": "hrp4",
        				"r2": "ground",
        				"r1Surface": "LeftFoot",
        				"r2Surface": "AllGround",
  				"dof":[0.0, 0.0, 1.0, 1.0, 1.0, 0.0],
  			}
  		],
  	},
  	"Stabilized_PutLeftFoot_Back":
  	{
  		"base": "Parallel",
  		"states":["Stabilizer::RightSupport", "PutLeftFoot_Back"]
  	},
  	"Stabilized_PutLeftFoot_Up":
  	{
  		"base": "Parallel",
  		"states":["Stabilizer::RightSupport", "PutLeftFoot_Up"]
  	},
  	"Stabilized_StepBack":
  	{
  		"base": "Meta",
  		"transitions":
      [
  			["Stabilized_StandingBack", "OK", "Stabilized_GoRightBack"],
  			["Stabilized_GoRightBack", "OK", "Stabilized_LiftLeftFoot_Back"],
  			["Stabilized_LiftLeftFoot_Back", "OK", "Stabilized_PutLeftFoot_Back"],
  			["Stabilized_PutLeftFoot_Back", "OK", "Stabilizer::GoCenter"],
  		],
        "AddCollisions": [
          {
             "r1": "hrp4",
             "r2": "wall",
             "collisions": [
                 {
                     "body1": "r_wrist",
                     "body2": "ground",
                     "iDist": 0.5,
                     "sDist": 0.02,
                     "damping": 0.0
                 }
            ]
          }
        ]
  	},
    "Pause3sec":
    {
      "base": "Pause",
      "duration": 3
    }
  },
  // Transitions map
  "transitions":
  [
    ["WipingController_CoM", "RightHandToBoard", "WipingController_RightHandToWhiteboard"],
    ["WipingController_CoM", "LeftHandToBoard", "WipingController_LeftHandToWhiteboard"],
    ["WipingController_CoM", "Slope", "Stabilized_StepUpSlope"],
    ["WipingController_CoM", "Stair", "Stabilized_StepUpStair"],


    ["Stabilized_StepUpSlope", "RightHand", "WipingController_RightHandToWhiteboard"],

    ["WipingController_RightHandToWhiteboard", "OK", "WipingController_PrepareWipingJSON_rh"],
    ["WipingController_PrepareWipingJSON_rh", "LeftHandToBoard", "WipingController_LeftHandToWhiteboard"],

    ["WipingController_LeftHandToWhiteboard", "OK", "WipingController_PrepareWipingJSON_lh"],
    //["Stabilized_StepUp", "OK", "Pause3sec"],
    //["Pause3sec", "OK", "Stabilized_StepBack"],
    //["Stabilized_StepUp", "OK", "Stabilized_GoCenter"],
    //["Stabilized_StepUpSlope", "OK", "Stabilized_RightHandToWhiteboard"],
    //["Stabilized_RightHandToWhiteboard", "OK", "WipingController_PrepareWipingJSON_rh"],



    ["WipingController_PrepareWipingJSON_rh", "WipingExperiment", "WipingController_PrepareWipingState"],
    ["WipingController_PrepareWipingJSON_lh", "WipingExperiment", "WipingController_PrepareWipingState"],
    ["WipingController_PrepareWipingJSON_rh", "PushWallExpeirment (CoMQP)", "WipingController_PreparePushWallAuto_rh"],
    ["WipingController_PrepareWipingJSON_rh", "PushWallExperiment (No ComQP)", "WipingController_PushWallNoCoMQP"],

    // PushWall experiment
    ["WipingController_PreparePushWallAuto_rh", "PushWallExperiment (ComQP)", "WipingController_PushWallCoMQP"],
    ["WipingController_PreparePushWallAuto_rh", "Abort", "WipingController_ReleasePushWallCoMQP"],
    ["WipingController_PushWallCoMQP", "Abort", "WipingController_ReleasePushWallCoMQP"],

    // Come back to halfsitting from PushWallComQP
    ["WipingController_PushWallCoMQP", "OK", "WipingController_ReleasePushWallCoMQP"],
    ["WipingController_ReleasePushWallCoMQP", "OK", "WipingController_PrepareMoveHandBack"],



    // Come back to halfsitting after Pushwall experiment without comQP
    ["WipingController_PushWallNoCoMQP", "Manual", "WipingController_PrepareMoveHandBackManual"],


    // Wiping experiment
    ["WipingController_PrepareWipingState_rh", "Abort", "WipingController_ReleasePushWallCoMQP"],
    ["WipingController_PrepareWipingState_rh", "Trajectory", "WipingController_WipeItStateTrajectory"],
    ["WipingController_PrepareWipingState_rh", "Velocity", "WipingController_WipeItStateConstantVelocity"],
    ["WipingController_PrepareWipingState_rh", "VelocityVertical", "WipingController_WipeItStateConstantVelocityVertical"],
    ["WipingController_PrepareWipingState_rh", "Acceleration", "WipingController_WipeItStateConstantAcceleration"],

    ["WipingController_WipeItStateTrajectory", "OK", "WipingController_ReleasePushWallCoMQP"],
    ["WipingController_WipeItStateConstantVelocity", "OK", "WipingController_ReleasePushWallCoMQP"],
    ["WipingController_WipeItStateConstantVelocityVertical", "OK", "WipingController_ReleasePushWallCoMQP"],
    ["WipingController_WipeItStateConstantAcceleration", "OK", "WipingController_ReleasePushWallCoMQP"],

    // Return to halfsitting
    ["WipingController_PrepareMoveHandBack", "OK", "WipingController_MoveRightHandDown"],
    ["WipingController_MoveRightHandDown", "OK", "Stabilized_StepBack"],
    ["Stabilized_StepBack", "OK", "WipingController_Finish"],
    ["WipingController_PrepareMoveHandBackManual", "Manual", "WipingController_Finish"],
    ["WipingController_Finish", "OK", "WipingController_HalfSittingWithCoM"],
    ["WipingController_HalfSittingWithCoM", "OK", "WipingController_HalfSitting"]
  ],
  // Initial state
  "init": "WipingController_CoM"
}
